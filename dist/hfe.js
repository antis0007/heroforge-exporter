(function(){"use strict";try{if(typeof document<"u"){var o=document.createElement("style");o.id="hfe-style",o.appendChild(document.createTextNode('::-webkit-scrollbar{width:8px}::-webkit-scrollbar-track{background-color:transparent}::-webkit-scrollbar-thumb{border-radius:4px;background-color:#e3e1e6;transition:background-color .5s}::-webkit-scrollbar-thumb:hover{background-color:#c8c6ca}.xkD2M{display:block;position:fixed;z-index:9999;top:calc(100dvh - 25px);left:25px;width:128px;height:258px;max-height:48px;overflow:hidden;background-color:#0003;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border-radius:5px;box-shadow:#64646f33 0 7px 29px;transition:all .5s cubic-bezier(.22,1,.36,1);box-sizing:border-box;font-optical-sizing:auto;font-size:12px;font-family:ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";color:#fff}.xkD2M.auoNx{max-height:258px}.K47n-{height:48px;display:flex;align-items:center;gap:2px;padding:0 8px;background-color:#0003;border-radius:8px}.GNasQ{height:100%;display:flex;align-items:center;gap:4px;flex:1;padding:0 8px;font-weight:500}.fR00k{width:32px;height:32px;display:flex;align-items:center;justify-content:center;padding:0;background-color:transparent;border:none;cursor:pointer}.fR00k>svg{width:14px;height:14px;color:#fff;transition:transform .3s}.xkD2M.auoNx .fR00k>svg{transform:rotate(180deg)}.Sf16X{width:100%;display:flex;flex-direction:column;gap:12px;padding:8px;box-sizing:border-box}._5r-1P{width:100%;display:flex;flex-direction:column;gap:4px}._36xn6{flex-direction:row;align-items:center;justify-content:space-between}.mq7-o{width:100%;height:32px;padding:0 8px;background-color:#fff3;border:none;border-radius:4px;color:#fff;box-sizing:border-box;outline:none}._5yyyX{display:flex;align-items:center;gap:8px;margin:0;font-size:14px;line-height:1;letter-spacing:.5px;color:#b9b3f3}._5yyyX>input[type=checkbox]{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#fff3;margin:0;font:inherit;color:currentColor;width:18px;height:18px;border-radius:2px;transform:translateY(-.075em);display:grid;place-content:center}._5yyyX>input[type=checkbox]:before{content:"";width:.65em;height:.65em;transform:scale(0);box-shadow:inset 1em 1em #fff;transform-origin:bottom left;clip-path:polygon(14% 44%,0 65%,50% 100%,100% 16%,80% 0%,43% 62%)}._5yyyX>input[type=checkbox]:checked:before{transform:scale(1)}.Pc646{width:100%;height:32px;padding:0 8px;background-color:#ff870099;border:none;border-radius:4px;color:#fff;font-weight:500;cursor:pointer;box-sizing:border-box;transition:background-color .3s}.Pc646:hover{background-color:#ff8700cc}@keyframes W4T6B{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}')),document.head.appendChild(o)}}catch(e){console.error("vite-plugin-css-injected-by-js",e)}})();
(function(F){typeof define=="function"&&define.amd?define(F):F()})((function(){"use strict";var be=Object.defineProperty;var ye=(F,z,V)=>z in F?be(F,z,{enumerable:!0,configurable:!0,writable:!0,value:V}):F[z]=V;var ct=(F,z,V)=>ye(F,typeof z!="symbol"?z+"":z,V);const V={equals:(t,e)=>t===e};let ft=pt;const I=1,G=2,ut={owned:null,cleanups:null,context:null,owner:null};var M=null;let ot=null,Vt=null,w=null,C=null,L=null,Y=0;function Ht(t,e){const n=w,r=M,s=t.length===0,o=e===void 0?r:e,l=s?ut:{owned:null,cleanups:null,context:o?o.context:null,owner:o},i=s?t:()=>t(()=>D(()=>W(l)));M=l,w=null;try{return K(i,!0)}finally{w=n,M=r}}function Z(t,e){e=e?Object.assign({},V,e):V;const n={value:t,observers:null,observerSlots:null,comparator:e.equals||void 0},r=s=>(typeof s=="function"&&(s=s(n.value)),dt(n,s));return[Kt.bind(n),r]}function H(t,e,n){const r=ht(t,e,!1,I);q(r)}function Pt(t,e,n){ft=jt;const r=ht(t,e,!1,I);r.user=!0,L?L.push(r):q(r)}function D(t){if(w===null)return t();const e=w;w=null;try{return t()}finally{w=e}}function Rt(t){Pt(()=>D(t))}function Dt(t){return M===null||(M.cleanups===null?M.cleanups=[t]:M.cleanups.push(t)),t}function Kt(){if(this.sources&&this.state)if(this.state===I)q(this);else{const t=C;C=null,K(()=>Q(this),!1),C=t}if(w){const t=this.observers?this.observers.length:0;w.sources?(w.sources.push(this),w.sourceSlots.push(t)):(w.sources=[this],w.sourceSlots=[t]),this.observers?(this.observers.push(w),this.observerSlots.push(w.sources.length-1)):(this.observers=[w],this.observerSlots=[w.sources.length-1])}return this.value}function dt(t,e,n){let r=t.value;return(!t.comparator||!t.comparator(r,e))&&(t.value=e,t.observers&&t.observers.length&&K(()=>{for(let s=0;s<t.observers.length;s+=1){const o=t.observers[s],l=ot&&ot.running;l&&ot.disposed.has(o),(l?!o.tState:!o.state)&&(o.pure?C.push(o):L.push(o),o.observers&&gt(o)),l||(o.state=I)}if(C.length>1e6)throw C=[],new Error},!1)),e}function q(t){if(!t.fn)return;W(t);const e=Y;Wt(t,t.value,e)}function Wt(t,e,n){let r;const s=M,o=w;w=M=t;try{r=t.fn(e)}catch(l){return t.pure&&(t.state=I,t.owned&&t.owned.forEach(W),t.owned=null),t.updatedAt=n+1,bt(l)}finally{w=o,M=s}(!t.updatedAt||t.updatedAt<=n)&&(t.updatedAt!=null&&"observers"in t?dt(t,r):t.value=r,t.updatedAt=n)}function ht(t,e,n,r=I,s){const o={fn:t,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:M,context:M?M.context:null,pure:n};return M===null||M!==ut&&(M.owned?M.owned.push(o):M.owned=[o]),o}function J(t){if(t.state===0)return;if(t.state===G)return Q(t);if(t.suspense&&D(t.suspense.inFallback))return t.suspense.effects.push(t);const e=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<Y);)t.state&&e.push(t);for(let n=e.length-1;n>=0;n--)if(t=e[n],t.state===I)q(t);else if(t.state===G){const r=C;C=null,K(()=>Q(t,e[0]),!1),C=r}}function K(t,e){if(C)return t();let n=!1;e||(C=[]),L?n=!0:L=[],Y++;try{const r=t();return Xt(n),r}catch(r){n||(L=null),C=null,bt(r)}}function Xt(t){if(C&&(pt(C),C=null),t)return;const e=L;L=null,e.length&&K(()=>ft(e),!1)}function pt(t){for(let e=0;e<t.length;e++)J(t[e])}function jt(t){let e,n=0;for(e=0;e<t.length;e++){const r=t[e];r.user?t[n++]=r:J(r)}for(e=0;e<n;e++)J(t[e])}function Q(t,e){t.state=0;for(let n=0;n<t.sources.length;n+=1){const r=t.sources[n];if(r.sources){const s=r.state;s===I?r!==e&&(!r.updatedAt||r.updatedAt<Y)&&J(r):s===G&&Q(r,e)}}}function gt(t){for(let e=0;e<t.observers.length;e+=1){const n=t.observers[e];n.state||(n.state=G,n.pure?C.push(n):L.push(n),n.observers&&gt(n))}}function W(t){let e;if(t.sources)for(;t.sources.length;){const n=t.sources.pop(),r=t.sourceSlots.pop(),s=n.observers;if(s&&s.length){const o=s.pop(),l=n.observerSlots.pop();r<s.length&&(o.sourceSlots[l]=r,s[r]=o,n.observerSlots[r]=l)}}if(t.tOwned){for(e=t.tOwned.length-1;e>=0;e--)W(t.tOwned[e]);delete t.tOwned}if(t.owned){for(e=t.owned.length-1;e>=0;e--)W(t.owned[e]);t.owned=null}if(t.cleanups){for(e=t.cleanups.length-1;e>=0;e--)t.cleanups[e]();t.cleanups=null}t.state=0}function Gt(t){return t instanceof Error?t:new Error(typeof t=="string"?t:"Unknown error",{cause:t})}function bt(t,e=M){throw Gt(t)}function Yt(t,e){return D(()=>t(e||{}))}function Zt(t,e,n){let r=n.length,s=e.length,o=r,l=0,i=0,a=e[s-1].nextSibling,f=null;for(;l<s||i<o;){if(e[l]===n[i]){l++,i++;continue}for(;e[s-1]===n[o-1];)s--,o--;if(s===l){const u=o<r?i?n[i-1].nextSibling:n[o-i]:a;for(;i<o;)t.insertBefore(n[i++],u)}else if(o===i)for(;l<s;)(!f||!f.has(e[l]))&&e[l].remove(),l++;else if(e[l]===n[o-1]&&n[i]===e[s-1]){const u=e[--s].nextSibling;t.insertBefore(n[i++],e[l++].nextSibling),t.insertBefore(n[--o],u),e[s]=n[o]}else{if(!f){f=new Map;let c=i;for(;c<o;)f.set(n[c],c++)}const u=f.get(e[l]);if(u!=null)if(i<u&&u<o){let c=l,d=1,h;for(;++c<s&&c<o&&!((h=f.get(e[c]))==null||h!==u+d);)d++;if(d>u-i){const b=e[l];for(;i<u;)t.insertBefore(n[i++],b)}else t.replaceChild(n[i++],e[l++])}else l++;else e[l++].remove()}}}const yt="_$DX_DELEGATE";function qt(t,e,n,r={}){let s;return Ht(o=>{s=o,e===document?t():ee(e,t(),e.firstChild?null:void 0,n)},r.owner),()=>{s(),e.textContent=""}}function Jt(t,e,n,r){let s;const o=()=>{const i=document.createElement("template");return i.innerHTML=t,i.content.firstChild},l=()=>(s||(s=o())).cloneNode(!0);return l.cloneNode=l,l}function Qt(t,e=window.document){const n=e[yt]||(e[yt]=new Set);for(let r=0,s=t.length;r<s;r++){const o=t[r];n.has(o)||(n.add(o),e.addEventListener(o,ne))}}function _(t,e){e==null?t.removeAttribute("class"):t.className=e}function mt(t,e,n={}){const r=Object.keys(e||{}),s=Object.keys(n);let o,l;for(o=0,l=s.length;o<l;o++){const i=s[o];!i||i==="undefined"||e[i]||(wt(t,i,!1),delete n[i])}for(o=0,l=r.length;o<l;o++){const i=r[o],a=!!e[i];!i||i==="undefined"||n[i]===a||!a||(wt(t,i,!0),n[i]=a)}return n}function te(t,e,n){return D(()=>t(e,n))}function ee(t,e,n,r){if(n!==void 0&&!r&&(r=[]),typeof e!="function")return tt(t,e,r,n);H(s=>tt(t,e(),s,n),r)}function wt(t,e,n){const r=e.trim().split(/\s+/);for(let s=0,o=r.length;s<o;s++)t.classList.toggle(r[s],n)}function ne(t){let e=t.target;const n=`$$${t.type}`,r=t.target,s=t.currentTarget,o=a=>Object.defineProperty(t,"target",{configurable:!0,value:a}),l=()=>{const a=e[n];if(a&&!e.disabled){const f=e[`${n}Data`];if(f!==void 0?a.call(e,f,t):a.call(e,t),t.cancelBubble)return}return e.host&&typeof e.host!="string"&&!e.host._$host&&e.contains(t.target)&&o(e.host),!0},i=()=>{for(;l()&&(e=e._$host||e.parentNode||e.host););};if(Object.defineProperty(t,"currentTarget",{configurable:!0,get(){return e||document}}),t.composedPath){const a=t.composedPath();o(a[0]);for(let f=0;f<a.length-2&&(e=a[f],!!l());f++){if(e._$host){e=e._$host,i();break}if(e.parentNode===s)break}}else i();o(r)}function tt(t,e,n,r,s){for(;typeof n=="function";)n=n();if(e===n)return n;const o=typeof e,l=r!==void 0;if(t=l&&n[0]&&n[0].parentNode||t,o==="string"||o==="number"){if(o==="number"&&(e=e.toString(),e===n))return n;if(l){let i=n[0];i&&i.nodeType===3?i.data!==e&&(i.data=e):i=document.createTextNode(e),n=R(t,n,r,i)}else n!==""&&typeof n=="string"?n=t.firstChild.data=e:n=t.textContent=e}else if(e==null||o==="boolean")n=R(t,n,r);else{if(o==="function")return H(()=>{let i=e();for(;typeof i=="function";)i=i();n=tt(t,i,n,r)}),()=>n;if(Array.isArray(e)){const i=[],a=n&&Array.isArray(n);if(rt(i,e,n,s))return H(()=>n=tt(t,i,n,r,!0)),()=>n;if(i.length===0){if(n=R(t,n,r),l)return n}else a?n.length===0?xt(t,i,r):Zt(t,n,i):(n&&R(t),xt(t,i));n=i}else if(e.nodeType){if(Array.isArray(n)){if(l)return n=R(t,n,r,e);R(t,n,null,e)}else n==null||n===""||!t.firstChild?t.appendChild(e):t.replaceChild(e,t.firstChild);n=e}}return n}function rt(t,e,n,r){let s=!1;for(let o=0,l=e.length;o<l;o++){let i=e[o],a=n&&n[t.length],f;if(!(i==null||i===!0||i===!1))if((f=typeof i)=="object"&&i.nodeType)t.push(i);else if(Array.isArray(i))s=rt(t,i,a)||s;else if(f==="function")if(r){for(;typeof i=="function";)i=i();s=rt(t,Array.isArray(i)?i:[i],Array.isArray(a)?a:[a])||s}else t.push(i),s=!0;else{const u=String(i);a&&a.nodeType===3&&a.data===u?t.push(a):t.push(document.createTextNode(u))}}return s}function xt(t,e,n=null){for(let r=0,s=e.length;r<s;r++)t.insertBefore(e[r],n)}function R(t,e,n,r){if(n===void 0)return t.textContent="";const s=r||document.createTextNode("");if(e.length){let o=!1;for(let l=e.length-1;l>=0;l--){const i=e[l];if(s!==i){const a=i.parentNode===t;!o&&!l?a?t.replaceChild(s,i):t.insertBefore(s,n):a&&i.remove()}else o=!0}}else t.insertBefore(s,n);return[s]}const X=class X{constructor(){ct(this,"files",[])}addFile(e,n){this.files.push({name:e,data:new Uint8Array(n)})}generate(){const e=[],n=[];let r=0;for(const f of this.files){const u=new TextEncoder().encode(f.name),c=this._createLocalHeader(u,f.data);e.push({header:c,data:f.data,offset:r}),r+=c.byteLength+f.data.byteLength}const s=r;for(let f=0;f<this.files.length;f++){const u=this.files[f],c=new TextEncoder().encode(u.name),d=this._createCentralHeader(c,u.data,e[f].offset);n.push(d),r+=d.byteLength}const o=r,l=this._createEOCD(this.files.length,o-s,s);r+=l.byteLength;const i=new Uint8Array(r);let a=0;for(const f of e)i.set(new Uint8Array(f.header),a),a+=f.header.byteLength,i.set(f.data,a),a+=f.data.byteLength;for(const f of n)i.set(new Uint8Array(f),a),a+=f.byteLength;return i.set(new Uint8Array(l),a),i.buffer}_createLocalHeader(e,n){const r=new ArrayBuffer(30+e.length),s=new DataView(r);return s.setUint32(0,67324752,!0),s.setUint16(4,20,!0),s.setUint16(6,0,!0),s.setUint16(8,0,!0),s.setUint16(10,0,!0),s.setUint16(12,0,!0),s.setUint32(14,this._crc32(n),!0),s.setUint32(18,n.byteLength,!0),s.setUint32(22,n.byteLength,!0),s.setUint16(26,e.length,!0),s.setUint16(28,0,!0),new Uint8Array(r).set(e,30),r}_createCentralHeader(e,n,r){const s=new ArrayBuffer(46+e.length),o=new DataView(s);return o.setUint32(0,33639248,!0),o.setUint16(4,20,!0),o.setUint16(6,20,!0),o.setUint16(8,0,!0),o.setUint16(10,0,!0),o.setUint16(12,0,!0),o.setUint16(14,0,!0),o.setUint32(16,this._crc32(n),!0),o.setUint32(20,n.byteLength,!0),o.setUint32(24,n.byteLength,!0),o.setUint16(28,e.length,!0),o.setUint16(30,0,!0),o.setUint16(32,0,!0),o.setUint16(34,0,!0),o.setUint16(36,0,!0),o.setUint32(38,0,!0),o.setUint32(42,r,!0),new Uint8Array(s).set(e,46),s}_createEOCD(e,n,r){const s=new ArrayBuffer(22),o=new DataView(s);return o.setUint32(0,101010256,!0),o.setUint16(4,0,!0),o.setUint16(6,0,!0),o.setUint16(8,e,!0),o.setUint16(10,e,!0),o.setUint32(12,n,!0),o.setUint32(16,r,!0),o.setUint16(20,0,!0),s}_crc32(e){let n=4294967295;const r=X._crc32Table||(X._crc32Table=this._makeCRCTable());for(let s=0;s<e.length;s++)n=n>>>8^r[(n^e[s])&255];return(n^4294967295)>>>0}_makeCRCTable(){const e=new Uint32Array(256);for(let n=0;n<256;n++){let r=n;for(let s=0;s<8;s++)r=r&1?3988292384^r>>>1:r>>>1;e[n]=r}return e}};ct(X,"_crc32Table",null);let it=X;function vt(t){return Math.abs(((n,r)=>(n%r+r)%r)(t+1,2)-1)}function $t(t,e){const n=new RK.Matrix4,r=t.bones?t.bones.length-1:-1;if(e<0||e>r)return n;const s=t.bones[e],o=t.boneInverses?t.boneInverses[e]:null;if(s&&o){const l=s.matrixWorld||(s.getMatrixWorld?s.getMatrixWorld():null);if(l)return n.copy(l),n.multiply(o),n}return n}function se(t,e,n,r,s){const o=t.geometry,l=t.skeleton,i=new RK.Vec3(n,r,s),a=[];for(let h=0;h<4;h++){const b=o.attributes[`skin${h}`];b&&a.push(b)}if(a.length===0||!l)return i.applyMatrix4(t.matrixWorld),i;const f=oe(t.bindMatrix),u=i.clone();!f&&t.bindMatrix&&u.applyMatrix4(t.bindMatrix);const c=new RK.Vec3(0,0,0);let d=0;for(const h of a){const b=Math.floor(h.getX(e)),x=vt(h.getY(e)),U=Math.floor(h.getZ(e)),y=vt(h.getW(e));if(x>1e-4){const v=$t(l,b),m=u.clone();m.applyMatrix4(v),c.addScaledVector(m,x),d+=x}if(y>1e-4){const v=$t(l,U),m=u.clone();m.applyMatrix4(v),c.addScaledVector(m,y),d+=y}}return d>1e-4?c.divideScalar(d):c.copy(u),!f&&t.bindMatrixInverse&&c.applyMatrix4(t.bindMatrixInverse),c}function oe(t){if(!t)return!0;const e=t.elements,n=1e-4;return Math.abs(e[0]-1)<n&&Math.abs(e[1])<n&&Math.abs(e[2])<n&&Math.abs(e[3])<n&&Math.abs(e[4])<n&&Math.abs(e[5]-1)<n&&Math.abs(e[6])<n&&Math.abs(e[7])<n&&Math.abs(e[8])<n&&Math.abs(e[9])<n&&Math.abs(e[10]-1)<n&&Math.abs(e[11])<n&&Math.abs(e[12])<n&&Math.abs(e[13])<n&&Math.abs(e[14])<n&&Math.abs(e[15]-1)<n}function re(t,e){const n=(t||"").toLowerCase(),r=(e||"").toLowerCase();return n.startsWith("base")||r.startsWith("base")||n.includes("pedestal")||r.includes("pedestal")}function ie(t,e){if(!t||!t.geometry||!t.visible||e!=null&&e.startsWith("_")||t.name==="facePads"||t.name==="_debugPass")return!1;const n=t.geometry.attributes.position;if(!n||n.count<3||t.geometry.type==="PlaneBufferGeometry"||t.geometry.type==="PlaneGeometry")return!1;const r=(t.name||"").toLowerCase();if(r.includes("ground")||r.includes("floor")||r.includes("plane")||r.includes("shadow")||r.includes("reflector"))return!1;const s=(e||"").toLowerCase();return!(s.includes("ground")||s.includes("floor")||s.includes("plane")||s.includes("shadow")||s.includes("reflector"))}function le(){const t=[],e=[],n=CK.activeDisplay;if(!n||!n.meshes)return console.error("No active display found."),{characterMeshes:t,baseMeshes:e};function r(s,o){if(s&&((s.isMesh||s.isSkinnedMesh)&&ie(s,o)&&(re(o,s.name)?e.push(s):t.push(s)),s.children))for(const l of s.children)l.name!=="facePads"&&l.name!=="_debugPass"&&r(l,o)}for(const[s,o]of Object.entries(n.meshes))!o||s.startsWith("_")||r(o,s);return console.log(`Collected ${t.length} character meshes, ${e.length} base meshes`),{characterMeshes:t,baseMeshes:e}}function Mt(t){var f,u;const e=t.geometry,n=e.attributes.position,r=n.count;if(t.updateMatrixWorld(!0),t.skeleton){if(t.skeleton.bones)for(const c of t.skeleton.bones)c&&c.updateMatrixWorld(!0);t.skeleton.update&&t.skeleton.update()}const s=((f=e.morphAttributes)==null?void 0:f.position)&&e.morphAttributes.position.length>0,o=t.morphTargetInfluences||[],l=[],i=e.index?e.index.array:null,a=t.isSkinnedMesh&&t.skeleton&&e.attributes.skin0;for(let c=0;c<r;c++){let d=n.getX(c),h=n.getY(c),b=n.getZ(c);if(s&&((u=e.morphAttributes)!=null&&u.position)){const U=e.morphAttributes.position;for(let y=0;y<U.length;y++){const v=o[y]||0;if(v>1e-4){const m=U[y];d+=m.getX(c)*v,h+=m.getY(c)*v,b+=m.getZ(c)*v}}}let x;a?x=se(t,c,d,h,b):(x=new RK.Vec3(d,h,b),x.applyMatrix4(t.matrixWorld)),l.push(x.x,x.y,x.z)}return{positions:l,indices:i}}function ae(t){const e=Mt(t),n=t.geometry.attributes.uv;let r=null;if(n&&n.count>0){r=new Array(n.count*2);for(let s=0;s<n.count;s++)r[s*2]=n.getX(s),r[s*2+1]=n.getY(s)}return{...e,uvs:r}}function St(t){const e=t.material;return e?Array.isArray(e)?e[0]||null:e:null}function Ct(t,e){return((t==null?void 0:t.name)||e||"material").trim().replace(/[^\w\-]+/g,"_")}function ce(t){if(!t)return[];const e=["map","normalMap","roughnessMap","metalnessMap","aoMap","emissiveMap","alphaMap"],n=[];for(const r of e){const s=t[r];s&&typeof s=="object"&&n.push({slot:r,tex:s})}return n}async function Ut(t){var e;try{const n=(t==null?void 0:t.image)||((e=t==null?void 0:t.source)==null?void 0:e.data)||null;if(!n)return null;const r=(n.width??n.videoWidth??n.naturalWidth)||0,s=(n.height??n.videoHeight??n.naturalHeight)||0;if(!r||!s)return null;const o=document.createElement("canvas");o.width=r,o.height=s;const l=o.getContext("2d");return l?(l.drawImage(n,0,0,r,s),await(await new Promise((a,f)=>{o.toBlob(u=>u?a(u):f(new Error("toBlob failed")),"image/png")})).arrayBuffer()):null}catch(n){return console.warn("Failed to convert texture to PNG:",n),null}}function fe(t,e,n){return kt(t,e,n)}function ue(t,e,n,r){const s=[],o=[],l=[],i=[];for(const c of t){const{positions:d,indices:h,uvs:b}=ae(c),x=[];for(let g=0;g<d.length;g+=3){const S=d[g],T=d[g+1],k=d[g+2],N=S*n,B=-k*n,P=T*n;x.push({x:N,y:B,z:P})}const U=s.length;s.push(...x);let y=o.length;if(b)for(let g=0;g<b.length;g+=2)o.push({u:b[g],v:b[g+1]});else y=-1;const v=St(c),m=Ct(v,c.name||"mesh"),$=[],E=(g,S,T)=>{const k=U+g+1,N=U+S+1,B=U+T+1,P=b?y+g+1:0,p=b?y+S+1:0,j=b?y+T+1:0;if(r){const at=s[U+g],et=s[U+S],nt=s[U+T],st=fe(at,et,nt);l.push(st);const O=l.length;b?$.push(`f ${k}/${P}/${O} ${N}/${p}/${O} ${B}/${j}/${O}`):$.push(`f ${k}//${O} ${N}//${O} ${B}//${O}`)}else b?$.push(`f ${k}/${P} ${N}/${p} ${B}/${j}`):$.push(`f ${k} ${N} ${B}`)};if(h)for(let g=0;g<h.length;g+=3)E(h[g],h[g+1],h[g+2]);else{const g=x.length;for(let S=0;S<g;S+=3)E(S,S+1,S+2)}i.push({materialName:m,faces:$})}let a=Number.POSITIVE_INFINITY;for(const c of s)a=Math.min(a,c.z);const f=-a+2.5;for(const c of s)c.z+=f;let u=`# HeroForge Export
`;u+=`mtllib ${e}.mtl
`,u+=`
`;for(const c of s)u+=`v ${c.x} ${c.y} ${c.z}
`;u+=`
`;for(const c of o)u+=`vt ${c.u} ${c.v}
`;if(u+=`
`,r){for(const c of l)u+=`vn ${c.x} ${c.y} ${c.z}
`;u+=`
`}for(const c of i){u+=`g ${c.materialName}
`,u+=`usemtl ${c.materialName}
`;for(const d of c.faces)u+=`${d}
`;u+=`
`}return{obj:u,groups:i,v:s,vt:o,vn:l}}function At(t,e="textures"){const n=new Set,r=[];let s=`# HeroForge Export

`;for(const o of t){const l=St(o);if(!l)continue;const i=Ct(l,o.name||"mesh");if(n.has(i))continue;n.add(i),s+=`newmtl ${i}
`,s+=`Ka 1.000 1.000 1.000
`,s+=`Kd 1.000 1.000 1.000
`,s+=`Ks 0.000 0.000 0.000
`,s+=`d 1.000
`,s+=`illum 2
`;const a=ce(l);for(const{slot:f,tex:u}of a){const d=`${(u.name||u.uuid||`${i}_${f}`).toString().replace(/[^\w\-]+/g,"_")}.png`,h=`${e}/${d}`;f==="map"?s+=`map_Kd ${h}
`:f==="normalMap"?s+=`map_Bump ${h}
`:f==="alphaMap"?s+=`map_d ${h}
`:f==="emissiveMap"&&(s+=`map_Ke ${h}
`),r.push({path:h,tex:u})}s+=`
`}return{mtl:s,textures:r}}function lt(t){return Math.abs(t.x)<100&&Math.abs(t.y)<100&&Math.abs(t.z)<100}function Et(t){const e=[];let n=0;for(const r of t){const{positions:s,indices:o}=Mt(r),l=a=>({x:s[a*3],y:s[a*3+1],z:s[a*3+2]}),i=(a,f,u)=>{const c=l(a),d=l(f),h=l(u);if(!lt(c)||!lt(d)||!lt(h)){n++;return}e.push({v1:c,v2:d,v3:h})};if(o)for(let a=0;a<o.length;a+=3)i(o[a],o[a+1],o[a+2]);else{const a=s.length/3;for(let f=0;f<a;f+=3)i(f,f+1,f+2)}}return n>0&&console.warn(`Skipped ${n} triangles with invalid coordinates`),e}function Tt(t,e){for(const s of t)for(const o of[s.v1,s.v2,s.v3]){const l=o.y,i=o.z;o.y=-i*e,o.z=l*e,o.x=o.x*e}let n=Number.POSITIVE_INFINITY;for(const s of t)for(const o of[s.v1,s.v2,s.v3])n=Math.min(n,o.z);const r=-n+2.5;for(const s of t)for(const o of[s.v1,s.v2,s.v3])o.z+=r;return t}function kt(t,e,n){const r=e.x-t.x,s=e.y-t.y,o=e.z-t.z,l=n.x-t.x,i=n.y-t.y,a=n.z-t.z;let f=s*a-o*i,u=o*l-r*a,c=r*i-s*l;const d=Math.sqrt(f*f+u*u+c*c);return d>0&&(f/=d,u/=d,c/=d),{x:f,y:u,z:c}}function _t(t,e="HeroForge Export"){const n=t.length,r=84+n*50,s=new ArrayBuffer(r),o=new DataView(s);for(let i=0;i<80;i++)o.setUint8(i,i<e.length?e.charCodeAt(i):0);o.setUint32(80,n,!0);let l=84;for(const i of t){const a=kt(i.v1,i.v2,i.v3);o.setFloat32(l,a.x,!0),l+=4,o.setFloat32(l,a.y,!0),l+=4,o.setFloat32(l,a.z,!0),l+=4,o.setFloat32(l,i.v1.x,!0),l+=4,o.setFloat32(l,i.v1.y,!0),l+=4,o.setFloat32(l,i.v1.z,!0),l+=4,o.setFloat32(l,i.v2.x,!0),l+=4,o.setFloat32(l,i.v2.y,!0),l+=4,o.setFloat32(l,i.v2.z,!0),l+=4,o.setFloat32(l,i.v3.x,!0),l+=4,o.setFloat32(l,i.v3.y,!0),l+=4,o.setFloat32(l,i.v3.z,!0),l+=4,o.setUint16(l,0,!0),l+=2}return s}function Ft(t,e){const n=new Blob([t],{type:"application/octet-stream"}),r=document.createElement("a");r.href=URL.createObjectURL(n),r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(r.href)}async function de(t={}){const{filename:e="heroforge-character",scale:n=10,separateBase:r=!0,format:s="stl",includeTextures:o=!0,includeNormals:l=!1}=t;if(console.log("Starting HeroForge character export..."),console.log(`  Scale: ${n}x`),console.log(`  Separate base: ${r}`),typeof CK>"u"||typeof RK>"u"){console.error("CK or RK not found. Make sure you are on the HeroForge character page.");return}CK.scene&&CK.scene.updateMatrixWorld(!0);const{characterMeshes:i,baseMeshes:a}=le();if(i.length===0&&a.length===0){console.error("No meshes found.");return}if(r||o||s==="obj"){const h=new it,b=(y,v,m)=>{const $=Et(y);Tt($,n);const E=_t($,v);h.addFile(m,E),console.log(`${v}: ${$.length} triangles`)},x=async(y,v)=>{const m=v.replace(/\.obj$/i,""),$=ue(y,`${m}`,n,l);let E=null;if(o){const g=At(y,"textures");E=g.mtl,h.addFile(`${m}.mtl`,new TextEncoder().encode(E).buffer);const S=new Set;for(const T of g.textures){if(S.has(T.path))continue;S.add(T.path);const k=await Ut(T.tex);k&&h.addFile(T.path,k)}}h.addFile(`${m}.obj`,new TextEncoder().encode($.obj).buffer)};if(i.length>0&&(s==="stl"?b(i,"HeroForge Character",`${e}-character.stl`):await x(i,`${e}-character`)),a.length>0&&(s==="stl"?b(a,"HeroForge Base",`${e}-base.stl`):await x(a,`${e}-base`)),s==="stl"&&o){const y=[...i,...a],v=At(y,"textures");h.addFile(`${e}-materials.mtl`,new TextEncoder().encode(v.mtl).buffer);const m=new Set;for(const $ of v.textures){if(m.has($.path))continue;m.add($.path);const E=await Ut($.tex);E&&h.addFile($.path,E)}}const U=h.generate();Ft(U,`${e}.zip`),console.log(`Export complete! Downloaded ${e}.zip`);return}const u=[...i,...a],c=Et(u);Tt(c,n);const d=_t(c);Ft(d,`${e}.stl`)}const A={root:"xkD2M",open:"auoNx",header:"K47n-",title:"GNasQ",toggle:"fR00k",content:"Sf16X",field:"_5r-1P",row:"_36xn6",input:"mq7-o",checkbox:"_5yyyX",button:"Pc646"};var he=Jt('<div id=heroforge-exporter><div><div>HeroForge Exporter</div><button type=button><svg xmlns=http://www.w3.org/2000/svg width=16 height=16 viewBox="0 0 24 24"fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round><title>Maximize</title><path d="m18 15-6-6-6 6"></path></svg></button></div><div><div><label for=scale>Scale</label><input type=number min=0.1 max=5 step=0.1 id=scale></div><div><label for=filename>Filename</label><input type=text id=filename></div><div><label for=separateBase>Separate base</label><div><input type=checkbox id=separateBase></div></div><input type=submit value=Export>');const pe=()=>{let t;const[e,n]=Z(!1),[r,s]=Z(1),[o,l]=Z(!1),[i,a]=Z("hero"),f=()=>{n(!e()),e()?t.style.top=`${Math.max(document.documentElement.clientHeight-258-25,25)}px`:t.style.top=`${Math.max(document.documentElement.clientHeight-48-25,25)}px`},u=()=>{t.style.top=`${Math.max(document.documentElement.clientHeight-t.clientHeight-25,25)}px`,t.style.left="25px"};Rt(()=>{window.addEventListener("resize",u),u()}),Dt(()=>{window.removeEventListener("resize",u)});const c=d=>{d.preventDefault(),de({scale:10*r(),filename:i(),separateBase:o()})};return(()=>{var d=he(),h=d.firstChild,b=h.firstChild,x=b.nextSibling,U=h.nextSibling,y=U.firstChild,v=y.firstChild,m=v.nextSibling,$=y.nextSibling,E=$.firstChild,g=E.nextSibling,S=$.nextSibling,T=S.firstChild,k=T.nextSibling,N=k.firstChild,B=S.nextSibling,P=t;return typeof P=="function"?te(P,d):t=d,x.$$click=f,m.$$input=p=>s(Number(p.target.value)),g.$$input=p=>a(p.target.value),N.$$input=p=>l(p.target.checked),B.$$click=c,H(p=>{var j=A.root,at={[A.open]:e()},et=A.header,nt=A.title,st=A.toggle,O=A.content,Lt=A.field,Nt=A.input,Bt=A.field,Ot=A.input,ge={[A.field]:!0,[A.row]:!0},zt=A.checkbox,It=A.button;return j!==p.e&&_(d,p.e=j),p.t=mt(d,at,p.t),et!==p.a&&_(h,p.a=et),nt!==p.o&&_(b,p.o=nt),st!==p.i&&_(x,p.i=st),O!==p.n&&_(U,p.n=O),Lt!==p.s&&_(y,p.s=Lt),Nt!==p.h&&_(m,p.h=Nt),Bt!==p.r&&_($,p.r=Bt),Ot!==p.d&&_(g,p.d=Ot),p.l=mt(S,ge,p.l),zt!==p.u&&_(k,p.u=zt),It!==p.c&&_(B,p.c=It),p},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0,h:void 0,r:void 0,d:void 0,l:void 0,u:void 0,c:void 0}),H(()=>m.value=r()),H(()=>g.value=i()),H(()=>N.checked=o()),d})()};Qt(["click","input"]),document.getElementById("heroforge-exporter")||qt(()=>Yt(pe,{}),document.body)}));
